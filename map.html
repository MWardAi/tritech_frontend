<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SmartTourist Map</title>
  
  <!-- Same styles as index.html -->
  <style>
    :root{
      --cream-1: #fffdf8;
      --cream-2: #fff6ea;
      --accent: #6aa6ff;
      --muted: #7b7b7b;
      --radius: 14px;
      --shadow: 0 8px 30px rgba(20,20,30,0.08);
    }

    html,body{
      height:100%;
      margin:0;
      background: linear-gradient(180deg, var(--cream-1) 0%, #eaf6ff 100%);
      color:#1b1b1b;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    nav {
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:12px 20px;
      background: rgba(255,255,255,0.9);
      backdrop-filter: blur(6px);
      border-bottom: 1px solid rgba(0,0,0,0.03);
    }

    .btn {
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      padding:8px 12px;
      border-radius:10px;
      border:none;
      cursor:pointer;
      font-weight:600;
      color:white;
      background: linear-gradient(90deg, var(--accent), #4b8bff);
      box-shadow: 0 6px 20px rgba(75,139,255,0.08);
    }

    .btn.secondary {
      background: transparent;
      color:var(--accent);
      border:1px solid rgba(106,166,255,0.12);
      box-shadow:none;
    }

    .small {
      font-size:13px;
      color:var(--muted);
    }

    /* Profile styles */
    .nav-profile {
      position: relative;
    }

    .nav-profile-btn {
      width:36px;
      height:36px;
      border-radius:8px;
      background:linear-gradient(135deg,#6aa6ff,#4b8bff);
      border:none;
      color:#fff;
      font-weight:800;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .nav-profile-menu {
      position: absolute;
      top: 100%;
      right: 0;
      margin-top: 8px;
      background: white;
      border-radius: 10px;
      box-shadow: var(--shadow);
      padding: 12px;
      min-width: 180px;
      z-index: 1000;
      border: 1px solid rgba(0,0,0,0.03);
    }

    main {
      padding:24px;
      max-width: 1200px;
      margin: 0 auto;
    }

    #map-container {
      width:100%;
      height:70vh;
      border-radius:var(--radius);
      border:1px dashed rgba(0,0,0,0.06);
      display:flex;
      align-items:center;
      justify-content:center;
      background: rgba(255,255,255,0.6);
      margin-top: 20px;
    }
  </style>
  
  <script>
    window.BASE_URL = window.BASE_URL || 'https://tritech-backend-1w10.onrender.com';
  </script>
</head>
<body>
  <nav>
    <div style="font-weight:800; font-size: 18px;">Smart Tourist</div>
    
    <!-- Profile button (same structure as index.html) -->
    <div id="nav-profile" class="nav-profile" style="display:none;">
      <button id="nav-profile-btn" class="nav-profile-btn" aria-haspopup="true" aria-expanded="false" title="Open profile menu">
        <span id="nav-profile-initial">U</span>
      </button>

      <div id="nav-profile-menu" class="nav-profile-menu" role="menu" aria-hidden="true" style="display:none;">
        <div id="nav-profile-username" class="small" style="margin-bottom:8px;font-weight:700;">Username</div>
        <div style="display:flex;gap:8px;">
          <button id="nav-logout" class="btn secondary" type="button" style="font-size: 12px;">Log out</button>
          <button id="nav-open-profile" class="btn" type="button" style="font-size: 12px;">Profile</button>
        </div>
      </div>
    </div>
  </nav>

  <main>
    <h1 style="margin: 0;">Interactive Map</h1>
    <p class="small">Explore tourist attractions in Syria</p>
    
    <div id="map-container">
      <div class="small" style="text-align: center; padding: 20px;">
        <div style="font-size: 24px; margin-bottom: 10px;">üó∫Ô∏è</div>
        Map placeholder ‚Äî Map provider will be initialized here
      </div>
    </div>
  </main>

  <!-- API and profile scripts -->
  <script src="api.js"></script>
  <script>
    // Profile functionality for map page
    (function() {
      const TOKEN_KEY = 'st_token';
      const token = localStorage.getItem(TOKEN_KEY);
      
      if (!token) {
        // Redirect to login if not authenticated
        window.location.href = 'index.html';
        return;
      }
      
      // Load user profile
      async function loadProfile() {
        try {
          const response = await fetch(window.BASE_URL + '/me', {
            headers: {
              'Authorization': 'Bearer ' + token
            }
          });
          
          if (response.ok) {
            const data = await response.json();
            if (data.user) {
              updateProfileDisplay(data.user);
              initProfileEvents();
            }
          } else {
            // Token might be invalid, redirect to login
            localStorage.removeItem(TOKEN_KEY);
            window.location.href = 'index.html';
          }
        } catch (error) {
          console.error('Failed to load profile:', error);
        }
      }
      
      // Update profile display
      function updateProfileDisplay(user) {
        const navProfile = document.getElementById('nav-profile');
        const navProfileInitial = document.getElementById('nav-profile-initial');
        const navProfileUsername = document.getElementById('nav-profile-username');
        
        if (!navProfile || !user) return;
        
        // Get user initial
        const initial = (user.username || user.email || 'U').charAt(0).toUpperCase();
        
        // Update elements
        if (navProfileInitial) {
          navProfileInitial.textContent = initial;
        }
        
        if (navProfileUsername) {
          navProfileUsername.textContent = user.username || user.email || 'User';
        }
        
        // Show the profile button
        navProfile.style.display = 'block';
      }
      
      // Initialize profile events
      function initProfileEvents() {
        const navProfileBtn = document.getElementById('nav-profile-btn');
        const navProfileMenu = document.getElementById('nav-profile-menu');
        const navLogout = document.getElementById('nav-logout');
        const navOpenProfile = document.getElementById('nav-open-profile');
        
        if (!navProfileBtn || !navProfileMenu) return;
        
        // Toggle profile menu
        navProfileBtn.addEventListener('click', function(e) {
          e.stopPropagation();
          const isVisible = navProfileMenu.style.display === 'block';
          navProfileMenu.style.display = isVisible ? 'none' : 'block';
          navProfileBtn.setAttribute('aria-expanded', !isVisible);
        });
        
        // Close menu when clicking outside
        document.addEventListener('click', function() {
          navProfileMenu.style.display = 'none';
          navProfileBtn.setAttribute('aria-expanded', 'false');
        });
        
        // Logout button
        if (navLogout) {
          navLogout.addEventListener('click', function(e) {
            e.preventDefault();
            localStorage.removeItem(TOKEN_KEY);
            window.location.href = 'index.html';
          });
        }
        
        // Open profile button (redirects to main page)
        if (navOpenProfile) {
          navOpenProfile.addEventListener('click', function(e) {
            e.preventDefault();
            window.location.href = 'index.html#profile';
          });
        }
      }
      
      // Initialize on page load
      document.addEventListener('DOMContentLoaded', loadProfile);
    })();
  </script>
</body>
</html>